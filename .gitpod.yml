# This configuration file was automatically generated by Gitpod.
# Please adjust to your needs (see https://www.gitpod.io/docs/introduction/learn-gitpod/gitpod-yaml)
# and commit this file to your remote git repository to share the goodness with others.

# Learn more from ready-to-use templates: https://www.gitpod.io/docs/introduction/getting-started/quickstart

tasks:
    -   name: Installing dependencies, Starting Database and building package
        before: |
            python3 -m pip install awscli
            echo "export PATH=/usr/local/bin:$PATH" >> ~/.bash_profile
            source ~/.bash_profile
            aws configure set aws_access_key_id $AWS_ACCESS_KEY
            aws configure set aws_secret_access_key $AWS_SECRET_PASSWORD
            aws configure set region ap-south-1
            export CODEARTIFACT_AUTH_TOKEN=`aws codeartifact get-authorization-token --domain barraiser --domain-owner 969111487786 --query authorizationToken --output text`
            cp pre-commit .git/hooks/
            mkdir /workspace/pems
            LF=$'\\\x0A'; echo "$staging_vpn_key" | sed -e "s/-----BEGIN RSA PRIVATE KEY-----/&${LF}/" -e "s/-----END RSA PRIVATE KEY-----/${LF}&${LF}/" | sed -e "s/[^[:blank:]]\{64\}/&${LF}/g" > /workspace/pems/staging-vpn.pem
            chmod 400 /workspace/pems/staging-vpn.pem
        init: |
            bash scripts/local_database_setup.sh
            mvn -Dmaven.repo.local=/workspace/m2-repository clean package -Dmaven.test.skip=true
            cp local-db-gitpod.conf local-db.conf
        command: |
            docker-compose start
            chmod 400 /workspace/pems/staging-vpn.pem
            bash scripts/set-service-forwarding-staging.sh
            bash scripts/set_URL_dynamo.sh
ports:
    -   port: 8008
        onOpen: ignore
    -   port: 5000
        onOpen: notify
        visibility: public
    -   port: 5432
        name: POSTGRES
        onOpen: ignore
    -   port: 5433
        name: POSTGRES
        onOpen: notify
    -   port: 5050
        name: pgadmin
        onOpen: notify
vscode:
    extensions:
        - vscjava.vscode-java-pack
